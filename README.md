# wpt-reports-for-dashboard

## 1. Overview
This dashboard displays the WebPageTest (WPT) results of the Huawei browser alongside those of other major browsers. The diagram below illustrates how this dashboard operates: It retrieves results for other browsers from the wpt.fyi staging public data server, while obtaining results for the Huawei browser from the [summary-results](https://github.com/wpt-dashboard/wpt-reports-for-dashboard/tree/main/summary-results) folder of this repository.

![image](https://github.com/wpt-dashboard/wpt-reports-for-dashboard/assets/2742826/b601a8c7-f407-4d86-8406-975603fe75cc)


## 2. Prerequisites
This project forked wpt.fyi dashboard to integrate WPT reports of the Huawei browser into the dashboard. To begin, you need to clone the [wpt-dashboard/wpt.fyi](https://github.com/wpt-dashboard/wpt.fyi) repository to your local environment. Next, set up the environment for wpt.fyi by following the [instructions](https://github.com/wpt-dashboard/wpt.fyi) provided here.

### 2.1 Download the forked wpt.fyi dashboard
This is the command to clone [wpt-dashboard/wpt.fyi](https://github.com/wpt-dashboard/wpt.fyi) repository.

```sh
$ git clone git@github.com:wpt-dashboard/wpt.fyi.git
```

### 2.2 Set up your environment for the wpt.fyi dashboard
You'll need [Docker](https://www.docker.com/). With Docker installed, start the development container:

```sh
wpt.fyi$ ./util/docker-dev/run.sh
```
This will start a Docker instance named `wptd-dev-instance`.

### 2.3 Download wpt-report-dashboard
If you successfully run the wpt.fyi server locally, you will also need to download the `wpt-report-dashboard` repository to operate our data server, which stores `runs.json` as well as `WPT reports` generated by the Huawei browser.

```sh
$ git clone git@github.com:wpt-dashboard/wpt-reports-for-dashboard.git
```

## 3. Run the wpt dashboard locally
As mentioned in [2.2 Set up your environment for wpt.fyi](https://github.com/wpt-dashboard/wpt-reports-for-dashboard/edit/main/README.md#22-setting-up-your-environment-for-wptfyi), you need to start the Docker instance named `wptd-dev-instance` first.

```sh
wpt.fyi$ ./util/docker-dev/run.sh
```
Once the instance is running, you can fire up the web server in another terminal:

```sh
wpt.fyi$ ./util/docker-dev/web_server.sh
```

This will build dependencies and start the Google App Engine development server inside `wptd-dev-instance`.

Meanwhile, you'll also need to populate the app datastore with some initial data. In another terminal,
execute the script which leverages `util/populate_dev_data.go` by running:

```sh
wpt.fyi$ ./util/docker-dev/dev_data.sh
```

After finishing populating the app datastore, you can access the dashboard via `https://localhost:8080` on a web browser.

## 4. Reflect a new WPT report to the dashboard

### 4.1 Run WPT on the Huawei browser
To compare WPT results with those of other browsers, you'll need to identify a specific commit SHA that the wpt.fyi dashboard used for running tests on those browsers, as we fetch results from the wpt.fyi dashboard. Our custom dashboard compares the Huawei browser with versions of Chrome (canary), Chrome Android, Firefox (experimental), and Safari (preview). You can locate the commits of other browsers that ran WPT tests via this [link](https://wpt.fyi/runs?label=master&max-count=100&from=2024-03-28T00%3A00&product=chrome%5Bexperimental%5D&product=firefox%5Bexperimental%5D&product=chrome_android&product=safari%5Bpreview%5D&aligned). Alternatively, you can easily find the commits using `--show-revisions` option in `wpt-reports-for-dashboard/uploadNewResult.sh` script, which will display a list of commits for other browsers' WPT runs on the wpt.fyi server.

```sh
wpt-reports-for-dashboard$ ./uploadNewResult.sh --show-revisions
["10de90ddb5","cd418e26d7","8de206e004","ad96776102","80e55580f8","820b6449e0","16f18d8135","a4a67cf7d5","57e5eb7b1a","ac8b032c18","1a37a72a12","e99b8186f7","3f44a73e21","d6c9b797f3","3bfcd2d3f1","94d4057fa2","21726d3bec","acabb88c58","c9e74b1951","f94851f9d6","8c53b2ec0e","b847b1030f","2da89e3238","c399cf9e27","49e8a846d9","efd5dd8342","1e23d2d783","caa8d8c413","9820252a70","aab5ae6d81","8421ab572f","fd3510de36","0267c3951d","33125ab6b5"]
```

After selecting the commit for running WPT on the Huawei browser, you'll need to execute WPT tests on the Huawei browser. Upon completion, please download `runner-results.json` using the download button provided.

![image](https://github.com/wpt-dashboard/wpt-reports-for-dashboard/assets/2742826/293e8f7a-b8dc-4b6b-aa7c-b3279ea966e8)

### 4.2 Rename the runner-results.json to result_[wpt-commit-full-revision]_[browser-version].json
You'll need to rename the `runner-results.json` file to include relevant metadata since it lacks information about the test run. Therefore, we append details such as the WPT commit full revision and browser version to the file name. Currently, we only include the WPT commit hash and browser version. The uploadNewResult.sh script facilitates this by accepting the candidate file name through the `--get-full-revision-from [short revision]` option. For instance, if the `runner-results.json` is generated by the WPT short revision `10de90ddb5`, you can obtain a suggested result name for our dashboard using this option.

```sh
wpt-reports-for-dashboard$ ./uploadNewResult.sh --get-full-revision-from 10de90ddb5                                                                                                                        [11:46:37]
Full revision hash: 10de90ddb53000556bea21d93dbb2492d0993f05
Suggested a result file name for this revision: result_10de90ddb53000556bea21d93dbb2492d0993f05_1.3.4.json
```

Rename `runner-results.json` to `result_10de90ddb53000556bea21d93dbb2492d0993f05_1.3.4.json`

```sh
$ mv runner-results.json result_10de90ddb53000556bea21d93dbb2492d0993f05_1.3.4.json
```

### 4.3 Upload the WPT result to wpt-reports-for-dashboard
Once you've renamed the result file, it's time to upload the result to the repository as follows:

```sh
wpt-reports-for-dashboard$ ./uploadNewResult.sh /path/to/result_10de90ddb53000556bea21d93dbb2492d0993f05_1.3.4.json
```

### 4.4 Restart wpt.fyi dashboard

If you have successfully committed the new result to the wpt-reports-dashboard repository, please proceed by restarting the Docker server, the web server, and populating the app's datastore with some initial data. Then, you will see the new WPT report on the page.






